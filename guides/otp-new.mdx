---
title: OTP (One-Time Passwords)
description: Implement secure authentication flows with OTP codes delivered via SMS. Learn how to request and verify OTP codes using developer apps.
icon: 'lock'
---

# OTP (One-Time Passwords)

OTP provides secure user verification through temporary codes delivered via SMS. This feature is essential for implementing secure authentication flows in your applications.

## What is OTP?

An OTP is a unique, time-limited code sent to a user's phone number for verification purposes. In Briq's implementation, OTP codes are delivered via SMS and require developer apps for access.

### Key Characteristics
- **Time-Limited**: Codes expire after a set duration
- **Single-Use**: Each code can only be used once  
- **Developer App Restricted**: Only accessible through configured developer apps
- **SMS Delivery**: Codes are sent via SMS messages
- **Workspace Access**: Requires workspaces with developer access enabled

## Requirements

### Developer Apps
OTP services can only be accessed through developer apps. You must:
1. Create a developer app
2. Link it to a workspace with `developer_access = true`
3. Use the developer app credentials for OTP requests

### Workspace Configuration
The workspace must have developer access enabled:
```bash
curl -X PATCH https://karibu.briq.tz/v1/workspace/update/ws_abc123xyz789def \
-H "Content-Type: application/json" \
-H "X-API-Key: your_api_key_here" \
-d '{
  "developer_access": true
}'
```

## OTP Workflow

### 1. Request OTP Code

```bash
curl -X POST https://karibu.briq.tz/v1/otp/request/ \
-H "Content-Type: application/json" \
-H "X-API-Key: your_api_key_here" \
-d '{
  "phone_number": "255712345678",
  "developer_app_id": "dev_app_abc123xyz789"
}'
```

**Response:**
```json
{
  "success": true,
  "otp_id": "otp_xyz789abc123def",
  "phone_number": "255712345678", 
  "message": "Your verification code is 123456",
  "sent_at": "2024-08-10T10:30:00Z",
  "expires_at": "2024-08-10T10:35:00Z"
}
```

### 2. Verify OTP Code

```bash
curl -X POST https://karibu.briq.tz/v1/otp/verify/ \
-H "Content-Type: application/json" \
-H "X-API-Key: your_api_key_here" \
-d '{
  "otp_id": "otp_xyz789abc123def",
  "code": "123456",
  "developer_app_id": "dev_app_abc123xyz789"
}'
```

**Response (Success):**
```json
{
  "success": true,
  "otp_id": "otp_xyz789abc123def",
  "verified": true,
  "message": "OTP verified successfully",
  "verified_at": "2024-08-10T10:32:00Z"
}
```

**Response (Failed):**
```json
{
  "success": false,
  "otp_id": "otp_xyz789abc123def", 
  "verified": false,
  "error": "Invalid or expired OTP code"
}
```

## Code Examples

### JavaScript/Node.js

```javascript
const axios = require('axios');

class BriqOTP {
  constructor(apiKey, developerAppId) {
    this.apiKey = apiKey;
    this.developerAppId = developerAppId;
    this.baseURL = 'https://karibu.briq.tz';
    this.headers = {
      'X-API-Key': apiKey,
      'Content-Type': 'application/json'
    };
  }

  async requestOTP(phoneNumber) {
    try {
      const response = await axios.post(`${this.baseURL}/v1/otp/request/`, {
        phone_number: phoneNumber,
        developer_app_id: this.developerAppId
      }, { headers: this.headers });
      
      return response.data;
    } catch (error) {
      console.error('Error requesting OTP:', error.response?.data);
      throw error;
    }
  }

  async verifyOTP(otpId, code) {
    try {
      const response = await axios.post(`${this.baseURL}/v1/otp/verify/`, {
        otp_id: otpId,
        code: code,
        developer_app_id: this.developerAppId
      }, { headers: this.headers });
      
      return response.data;
    } catch (error) {
      console.error('Error verifying OTP:', error.response?.data);
      throw error;
    }
  }

  // Complete OTP verification flow
  async verifyPhoneNumber(phoneNumber) {
    try {
      // Step 1: Request OTP
      console.log('Requesting OTP for:', phoneNumber);
      const otpRequest = await this.requestOTP(phoneNumber);
      
      if (!otpRequest.success) {
        throw new Error('Failed to send OTP');
      }
      
      console.log('OTP sent successfully, ID:', otpRequest.otp_id);
      
      // In a real application, you would get the code from user input
      // For demo purposes, we're just returning the OTP ID
      return {
        otpId: otpRequest.otp_id,
        message: 'OTP sent successfully. Please check your SMS.',
        expiresAt: otpRequest.expires_at
      };
      
    } catch (error) {
      console.error('Phone verification failed:', error);
      throw error;
    }
  }

  async completeVerification(otpId, userCode) {
    try {
      console.log('Verifying code:', userCode);
      const verification = await this.verifyOTP(otpId, userCode);
      
      if (verification.verified) {
        console.log('Phone number verified successfully!');
        return {
          success: true,
          message: 'Phone number verified successfully',
          verifiedAt: verification.verified_at
        };
      } else {
        return {
          success: false,
          message: verification.error || 'Invalid verification code'
        };
      }
      
    } catch (error) {
      console.error('Verification failed:', error);
      return {
        success: false,
        message: 'Verification failed. Please try again.'
      };
    }
  }
}

// Usage example
const otpService = new BriqOTP('your_api_key_here', 'dev_app_abc123xyz789');

// User registration flow with phone verification
async function registerUser(phoneNumber) {
  try {
    // Request OTP
    const otpResult = await otpService.verifyPhoneNumber(phoneNumber);
    console.log(otpResult.message);
    
    // Simulate user entering the code (in real app, get from form input)
    const userEnteredCode = '123456'; // This would come from user input
    
    // Verify the code
    const verificationResult = await otpService.completeVerification(
      otpResult.otpId, 
      userEnteredCode
    );
    
    if (verificationResult.success) {
      console.log('User registration completed with verified phone number');
      // Proceed with user registration
    } else {
      console.log('Phone verification failed:', verificationResult.message);
      // Handle verification failure
    }
    
  } catch (error) {
    console.error('Registration process failed:', error);
  }
}

// Start registration
registerUser('255712345678');
```

### Python

```python
import requests
import time

class BriqOTP:
    def __init__(self, api_key, developer_app_id):
        self.api_key = api_key
        self.developer_app_id = developer_app_id
        self.base_url = 'https://karibu.briq.tz'
        self.headers = {
            'X-API-Key': api_key,
            'Content-Type': 'application/json'
        }
    
    def request_otp(self, phone_number):
        """Request OTP code for phone number"""
        data = {
            'phone_number': phone_number,
            'developer_app_id': self.developer_app_id
        }
        
        response = requests.post(
            f'{self.base_url}/v1/otp/request/',
            json=data,
            headers=self.headers
        )
        
        return response.json()
    
    def verify_otp(self, otp_id, code):
        """Verify OTP code"""
        data = {
            'otp_id': otp_id,
            'code': code,
            'developer_app_id': self.developer_app_id
        }
        
        response = requests.post(
            f'{self.base_url}/v1/otp/verify/',
            json=data,
            headers=self.headers
        )
        
        return response.json()
    
    def verify_phone_number(self, phone_number):
        """Complete phone number verification flow"""
        try:
            # Request OTP
            print(f"Requesting OTP for {phone_number}...")
            otp_request = self.request_otp(phone_number)
            
            if not otp_request.get('success'):
                raise Exception('Failed to send OTP')
            
            print(f"OTP sent successfully. ID: {otp_request['otp_id']}")
            print(f"Code expires at: {otp_request['expires_at']}")
            
            return otp_request['otp_id']
            
        except Exception as e:
            print(f"Phone verification failed: {e}")
            return None
    
    def complete_verification(self, otp_id, user_code):
        """Complete the verification with user-provided code"""
        try:
            print(f"Verifying code: {user_code}")
            verification = self.verify_otp(otp_id, user_code)
            
            if verification.get('verified'):
                print("Phone number verified successfully!")
                return {
                    'success': True,
                    'message': 'Phone number verified successfully',
                    'verified_at': verification.get('verified_at')
                }
            else:
                return {
                    'success': False,
                    'message': verification.get('error', 'Invalid verification code')
                }
                
        except Exception as e:
            print(f"Verification failed: {e}")
            return {
                'success': False,
                'message': 'Verification failed. Please try again.'
            }

# Usage example
otp_service = BriqOTP('your_api_key_here', 'dev_app_abc123xyz789')

def user_registration_flow(phone_number):
    """Simulate user registration with phone verification"""
    
    # Step 1: Request OTP
    otp_id = otp_service.verify_phone_number(phone_number)
    
    if not otp_id:
        print("Failed to start verification process")
        return False
    
    # Step 2: Simulate user entering the code
    # In a real application, you would get this from user input
    user_code = input("Enter the verification code sent to your phone: ")
    
    # Step 3: Verify the code
    result = otp_service.complete_verification(otp_id, user_code)
    
    if result['success']:
        print("Registration completed with verified phone number!")
        # Proceed with user registration in your system
        return True
    else:
        print(f"Verification failed: {result['message']}")
        return False

# Example usage
if __name__ == "__main__":
    phone = "255712345678"
    success = user_registration_flow(phone)
    
    if success:
        print("User successfully registered and verified")
    else:
        print("Registration process failed")
```

## Best Practices

### Security
1. **Expire Codes**: Implement reasonable expiration times for OTP codes
2. **Rate Limiting**: Limit OTP requests per phone number to prevent abuse
3. **Secure Storage**: Never store OTP codes in plain text
4. **Input Validation**: Validate phone numbers before requesting OTP

### User Experience  
1. **Clear Instructions**: Provide clear messaging about OTP process
2. **Resend Options**: Allow users to request new codes if needed
3. **Error Handling**: Provide helpful error messages for failed verification
4. **Timeout Feedback**: Show users how long codes remain valid

### Developer Apps
1. **Dedicated Apps**: Create specific developer apps for OTP services
2. **Workspace Linking**: Ensure apps are linked to workspaces with developer access
3. **Credential Security**: Secure developer app credentials appropriately
4. **Access Monitoring**: Monitor and log OTP access patterns

### Integration
1. **Error Recovery**: Implement retry logic for failed requests
2. **Logging**: Log OTP events for monitoring and debugging
3. **Testing**: Use test phone numbers during development
4. **Monitoring**: Track OTP success rates and delivery times

## Common Use Cases

### User Registration
```javascript
// Request OTP during registration
const otpRequest = await otpService.requestOTP('255712345678');
// User enters code from SMS
const verification = await otpService.verifyOTP(otpRequest.otp_id, '123456');
```

### Login Security
```python
# Two-factor authentication
otp_id = otp_service.request_otp(user.phone_number)
# User provides code
result = otp_service.verify_otp(otp_id, user_entered_code)
if result['verified']:
    # Complete login process
    authenticate_user(user)
```

### Password Reset
```javascript
// Before allowing password reset
const otpResult = await otpService.requestOTP(user.phoneNumber);
const verification = await otpService.verifyOTP(otpResult.otp_id, userCode);
if (verification.verified) {
    // Allow password reset
    enablePasswordReset(user);
}
```

## Next Steps

- **Developer Apps**: Learn how to [create and manage developer apps](/guides/developer-apps) for OTP access
- **Workspace Setup**: Configure [workspaces with developer access](/guides/workspaces) for OTP services
- **Integration**: Implement OTP in your authentication flows
- **Testing**: Test OTP workflows in your development environment

---

*For detailed API reference, visit [OTP API](/Karibu-OTP)*
